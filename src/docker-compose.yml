version: '3.4'

services:

  rabbitmq:
    image: rabbitmq:3-management-alpine
    container_name: RabbitMQ

  postgres:
    image: postgres:latest
    container_name: Postgres

  apigatewayweb:
    image: ${DOCKER_REGISTRY-}apigatewayweb
    build:
      context: .
      dockerfile: ApiGateways/Web/ApiGateway.Web/Dockerfile
    depends_on:
      - post
      - user

  post:
    image: ${DOCKER_REGISTRY-}post
    build:
      context: .
      dockerfile: Services/Post/Post.Api/Dockerfile
    depends_on:
      - rabbitmq
      - postgres

  user:
    image: ${DOCKER_REGISTRY-}user
    build:
      context: .
      dockerfile: Services/User/User.Api/Dockerfile
    depends_on:
      - rabbitmq
      - postgres
